!function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){for(var t in e)return!1;return!0}function i(e){return"string"==typeof e||e instanceof String}function o(e){return!isNaN(e)}function s(e){return void 0===e}function u(e,t){return delete t._rev,t.$createdAt=(new Date).toJSON(),t.$id?(t._id=t.$id+"_"+t.$createdAt,e.put(t).then(function(n){return n.$id=t.$id,c(e,n),n}).catch(function(e){if(409!==e.status)throw e})):e.post(t).then(function(t){return t.$id=t.id,c(e,{id:t.id}),t})}function c(e,t){e.get(t.id).then(function(e){var t=e.$id?e.$id:e._id;n.wasDeleted(t)||(e.$deleted?(n.markDeletion(t),n.delta.emit("delete",t)):e.$id?n.delta.emit("update",e):(e.$id=t,n.delta.emit("create",e)))})}function f(e){e.delta.removeAllListeners()}function l(e,t){var n={},r=!1;for(var i in t)e[i]!==t[i]&&(r=!0,n[i]=t[i]);return r?n:null}function a(e,t){return e.get(t).then(function(t){return e.remove(t)}).catch(function(e){if(404!==e.status)throw e})}function h(e,t,n){var r=[];return t.rows.forEach(function(t){n[t.doc.$id]&&r.push(a(e,t.id))}),v.all(r)}function d(e,t,r,i){return e.get(t.doc._id).then(function(o){if(t.doc.$id||(t.doc.$id=t.doc._id),t.doc.$deleted||i[t.doc.$id])return i[t.doc.$id]=!0,e.remove(o);if(r[t.doc.$id]){var s=!1;for(var u in t.doc)if(void 0===r[t.doc.$id][u]){s=!0;break}if(!s)return e.remove(o);r[t.doc.$id]=n.merge(r[t.doc.$id],t.doc)}else r[t.doc.$id]=t.doc})}var v=e("./pouch-utils").Promise,p=e("events");n.delta=new p.EventEmitter,n.deltaInit=function(){this.on("destroyed",function(){f(this)})},n.clone=function(e){return JSON.parse(JSON.stringify(e))},n.merge=function(e,t){var n={};for(var r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n},n.save=function(e){return u(this,e)},n.delete=function(e){var t=i(e)||o(e)?e:e.$id;if(s(t))throw new Error("missing $id");return u(this,{$id:t,$deleted:!0})},n.all=function(){var e={},t={};return this.allDocs({include_docs:!0}).then(function(r){return r.rows.forEach(function(r){r.doc.$id||(r.doc.$id=r.doc._id),r.doc.$deleted?(delete e[r.doc.$id],t[r.doc.$id]=!0):t[r.doc.$id]||(e[r.doc.$id]?e[r.doc.$id]=n.merge(e[r.doc.$id],r.doc):e[r.doc.$id]=r.doc)}),e})};var m={};n.wasDeleted=function(e){return!!m[e]},n.markDeletion=function(e){m[e]=!0},n.saveChanges=function(e,t){var n=this,r=l(e,t);return null!==r?(r.$id=e.$id,n.save(r).then(function(){return r})):v.resolve()},n.getAndRemove=function(e){return a(this,e)};var y=function(e,t,n,r){return function(){return d(e,t,n,r)}};n.cleanup=function(){var e=this;return e.allDocs({include_docs:!0}).then(function(t){var n={},i={},o=v.resolve();return t.rows.forEach(function(t){o=o.then(y(e,t,n,i))}),o.then(function(){if(!r(i))return h(e,t,i)})})},"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{"./pouch-utils":7,events:2}],2:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function u(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,c,f;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],u(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),r=(f=n.slice()).length,c=0;c<r;c++)f[c].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=u(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(u=o;u-- >0;)if(n[u]===t||n[u].listener&&n[u].listener===t){r=u;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,t,n){(function(e){"use strict";function n(){f=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}f=!1}var r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(n),u=e.document.createTextNode("");s.observe(u,{characterData:!0}),r=function(){u.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,r=function(){c.port2.postMessage(0)}}var f,l=[];t.exports=function(e){1!==l.push(e)||f||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],5:[function(e,t,n){"use strict";function r(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,e!==r&&c(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(e,t,n){l(function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)})}function u(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function c(e,t){function n(t){i||(i=!0,a.reject(e,t))}function r(t){i||(i=!0,a.resolve(e,t))}var i=!1,o=f(function(){t(r,n)});"error"===o.status&&n(o.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}var l=e("immediate"),a={},h=["REJECTED"],d=["FULFILLED"],v=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===h)return this;var n=new this.constructor(r);return this.state!==v?s(n,this.state===d?e:t,this.outcome):this.queue.push(new o(n,e,t)),n},o.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){a.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=f(u,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)c(e,r);else{e.state=d,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=h,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},i.resolve=function(e){return e instanceof this?e:a.resolve(new this(r),e)},i.reject=function(e){var t=new this(r);return a.reject(t,e)},i.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,c=new this(r);++u<n;)!function(e,r){t.resolve(e).then(function(e){o[r]=e,++s!==n||i||(i=!0,a.resolve(c,o))},function(e){i||(i=!0,a.reject(c,e))})}(e[u],u);return c},i.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(r);++o<n;)!function(e){t.resolve(e).then(function(e){i||(i=!0,a.resolve(s,e))},function(e){i||(i=!0,a.reject(s,e))})}(e[o]);return s}},{immediate:3}],6:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(a===setTimeout)return setTimeout(e,0);if((a===r||!a)&&setTimeout)return a=setTimeout,setTimeout(e,0);try{return a(e,0)}catch(t){try{return a.call(null,e,0)}catch(t){return a.call(this,e,0)}}}function s(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function u(){m&&v&&(m=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!m){var e=o(u);m=!0;for(var t=p.length;t;){for(v=p,p=[];++y<t;)v&&v[y].run();y=-1,t=p.length}v=null,m=!1,s(e)}}function f(e,t){this.fun=e,this.array=t}function l(){}var a,h,d=t.exports={};!function(){try{a="function"==typeof setTimeout?setTimeout:r}catch(e){a=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var v,p=[],m=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new f(e,t)),1!==p.length||m||o(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],7:[function(e,t,n){(function(t,r){"use strict";var i;i="undefined"!=typeof window&&window.PouchDB?window.PouchDB.utils.Promise:"function"==typeof r.Promise?r.Promise:e("lie"),n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");t=!0,e.apply(this,n)})},n.getArguments=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}},n.toPromise=function(e){return n.getArguments(function(r){var o,s=this,u="function"==typeof r[r.length-1]&&r.pop();u&&(o=function(e,n){t.nextTick(function(){u(e,n)})});var c=new i(function(t,i){try{var o=n.once(function(e,n){e?i(e):t(n)});r.push(o),e.apply(s,r)}catch(e){i(e)}});return o&&c.then(function(e){o(null,e)},o),c.cancel=function(){return this},c})},n.inherits=e("inherits"),n.Promise=i}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:6,inherits:4,lie:5}]},{},[1]);
